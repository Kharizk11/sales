<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงููุจูุนุงุช - SAP Fiori Style</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a6ed1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ูุธุงู ุงููุจูุนุงุช">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts: Using Arial/Helvetica as SAP 72 fallback -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css?v=3">
    <link rel="stylesheet" href="css/sap-theme.css?v=3">
    <!-- <link rel="stylesheet" href="css/home-enhanced.css"> -->


    <!-- Firebase Scripts (Load First) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Config (Load Before Data) -->
    <script src="js/core/config.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- SAP Shell Header -->
        <header class="shell-header">
            <button class="btn-sap btn-transparent" onclick="toggleSidebar()" style="color: white; margin-left: 10px;">
                โฐ
            </button>
            <div class="shell-logo">
                <span style="font-size: 1.2rem;">๐</span>
                <span>ูุธุงู ุงููุจูุนุงุช</span>
            </div>
            <div class="shell-actions">
                <button class="btn-sap btn-transparent" style="color: white;" onclick="updateDashboard()">
                    ๐ ุชุญุฏูุซ
                </button>
                <button class="btn-sap btn-transparent" style="color: white;">
                    ๐ค ุงููุฏูุฑ
                </button>
            </div>
        </header>

        <div class="app-body">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <nav class="nav-links">
                    <div class="nav-item active" onclick="navigateTo('home')">
                        <span class="nav-icon">๐</span>
                        <span>ุงูุฑุฆูุณูุฉ</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('sales')">
                        <span class="nav-icon">๐ฐ</span>
                        <span>ุชุณุฌูู ุงููุจูุนุงุช</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('branches')">
                        <span class="nav-icon">๐ข</span>
                        <span>ุงููุฑูุน</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('analytics')">
                        <span class="nav-icon">๐</span>
                        <span>ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('reconciliation')">
                        <span class="nav-icon">โ๏ธ</span>
                        <span>ุชุณููุฉ ุงูุตูุฏูู</span>
                    </div>
                    <div class="nav-item" onclick="navigateTo('settings')">
                        <span class="nav-icon">โ๏ธ</span>
                        <span>ุงูุฅุนุฏุงุฏุงุช</span>
                    </div>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="main-content">

                <!-- HOME SECTION (Launchpad) -->
                <div id="home-section" class="page-section">
                    <h2 style="margin-bottom: 1.5rem; color: var(--sap-text-primary);">ููุญุฉ ุงูุชุญูู</h2>

                    <!-- Launchpad Tiles Grid -->
                    <div class="tile-grid">
                        <!-- Sales Tile -->
                        <div class="sap-tile" onclick="navigateTo('sales')">
                            <div class="sap-tile-title">ุชุณุฌูู ุงููุจูุนุงุช</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number">+</div>
                                <div class="sap-tile-info">ุนูููุฉ ุฌุฏูุฏุฉ</div>
                            </div>
                            <div class="sap-tile-icon">๐ฐ</div>
                        </div>

                        <!-- Today's Sales Stat -->
                        <div class="sap-tile">
                            <div class="sap-tile-title">ูุจูุนุงุช ุงูููู</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="statToday">
                                    <span class="loading-skeleton" style="font-size: 1.5rem;">...</span>
                                </div>
                                <div class="sap-tile-info" id="statTodayTrend">--</div>
                            </div>
                            <div class="sap-tile-icon">๐</div>
                        </div>

                        <!-- Month Sales Stat -->
                        <div class="sap-tile">
                            <div class="sap-tile-title">ูุจูุนุงุช ุงูุดูุฑ</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="statMonth">
                                    <span class="loading-skeleton" style="font-size: 1.5rem;">...</span>
                                </div>
                                <div class="sap-tile-info" id="statMonthTrend">--</div>
                            </div>
                            <div class="sap-tile-icon">๐</div>
                        </div>

                        <!-- Branches Stat -->
                        <div class="sap-tile" onclick="navigateTo('branches')">
                            <div class="sap-tile-title">ุงููุฑูุน ุงููุดุทุฉ</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="statBranches">
                                    <span class="loading-skeleton" style="font-size: 1.5rem;">...</span>
                                </div>
                                <div class="sap-tile-info">ุฅุฏุงุฑุฉ ุงููุฑูุน</div>
                            </div>
                            <div class="sap-tile-icon">๐ข</div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ุชุญููู ุงููุจูุนุงุช (7 ุฃูุงู)</h3>
                            </div>
                            <div class="sap-card-content" style="height: 300px; position: relative;">
                                <canvas id="dailySalesChart"></canvas>
                            </div>
                        </div>
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ุชูุฒูุน ุงููุฑูุน</h3>
                            </div>
                            <div class="sap-card-content" style="height: 300px; position: relative;">
                                <canvas id="branchesChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sales Table -->
                    <div class="sap-card">
                        <div class="sap-card-header">
                            <h3 class="sap-card-title">ุขุฎุฑ ุงูุนูููุงุช ุงููุณุฌูุฉ</h3>
                            <button class="btn-sap btn-transparent" onclick="navigateTo('sales')">ุนุฑุถ ุงููู</button>
                        </div>
                        <div class="sap-card-content" style="padding: 0;">
                            <div style="overflow-x: auto;">
                                <table class="sap-table" id="recentSalesTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>ุงูุชุงุฑูุฎ</th>
                                            <th>ุงููุฑุน</th>
                                            <th>ุงููุตู</th>
                                            <th>ุงููุจูุบ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentSalesBody">
                                        <tr>
                                            <td colspan="5" style="text-align: center; padding: 2rem;">ุฌุงุฑู ุงูุชุญููู...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SALES SECTION -->
                <div id="sales-section" class="page-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0;">ุชุณุฌูู ุงููุจูุนุงุช</h2>
                        <button class="btn-sap btn-standard" onclick="toggleSalesTable()" id="toggleSalesBtn">๐ ุนุฑุถ
                            ุงูุณุฌู</button>
                    </div>

                    <div class="sap-card">
                        <div class="sap-card-header">
                            <h3 class="sap-card-title">ุจูุงูุงุช ุงูุนูููุฉ</h3>
                        </div>
                        <div class="sap-card-content">
                            <form id="cleanSalesForm" onsubmit="handleCleanSubmit(event)">
                                <input type="hidden" id="saleId">

                                <div
                                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                                    <div class="sap-input-group">
                                        <label class="sap-label">ุงูุชุงุฑูุฎ</label>
                                        <input type="date" id="saleDate" class="sap-input" required>
                                    </div>
                                    <div class="sap-input-group">
                                        <label class="sap-label">ุงููุฑุน</label>
                                        <select id="saleBranch" class="sap-input" required>
                                            <option value="">ุงุฎุชุฑ ุงููุฑุน...</option>
                                        </select>
                                    </div>
                                    <div class="sap-input-group">
                                        <label class="sap-label">ุงููุจูุบ (ุฑูุงู)</label>
                                        <input type="number" id="saleAmount" class="sap-input" step="0.01" min="0"
                                            placeholder="0.00" required>
                                    </div>
                                </div>

                                <div class="sap-input-group">
                                    <label class="sap-label">ุงููุตู / ุงูุจูุงู</label>
                                    <input type="text" id="saleDescription" class="sap-input"
                                        placeholder="ูุซุงู: ุฅูุฑุงุฏ ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ">
                                </div>

                                <div class="sap-input-group">
                                    <label class="sap-label">ููุงุญุธุงุช</label>
                                    <textarea id="saleNotes" class="sap-input" rows="3"
                                        style="height: auto; padding-top: 0.5rem;"></textarea>
                                </div>

                                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                                    <button type="button" class="btn-sap btn-standard"
                                        onclick="resetCleanForm()">ุชูุฑูุบ</button>
                                    <button type="submit" class="btn-sap btn-emphasized">ุญูุธ ุงูุนูููุฉ</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Sales List -->
                    <div id="salesListSection" style="display: none; margin-top: 2rem;">
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ุณุฌู ุงูุนูููุงุช</h3>
                                <input type="text" id="searchSales" class="sap-input" placeholder="ุจุญุซ..."
                                    style="width: 200px;">
                            </div>
                            <div class="sap-card-content" style="padding: 0;">
                                <div style="overflow-x: auto;">
                                    <table class="sap-table" id="salesTable">
                                        <thead>
                                            <tr>
                                                <th>ุงูุชุงุฑูุฎ</th>
                                                <th>ุงููุฑุน</th>
                                                <th>ุงููุตู</th>
                                                <th>ุงููุจูุบ</th>
                                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                            </tr>
                                        </thead>
                                        <tbody id="salesTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BRANCHES SECTION -->
                <div id="branches-section" class="page-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0;">ุฅุฏุงุฑุฉ ุงููุฑูุน</h2>
                        <button class="btn-sap btn-emphasized" onclick="openBranchModal()">โ ุฅุถุงูุฉ ูุฑุน</button>
                    </div>

                    <!-- Branch Stats Tiles -->
                    <div class="tile-grid">
                        <div class="sap-tile">
                            <div class="sap-tile-title">ุฅุฌูุงูู ุงููุฑูุน</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="totalBranches">--</div>
                            </div>
                            <div class="sap-tile-icon">๐ข</div>
                        </div>
                        <div class="sap-tile">
                            <div class="sap-tile-title">ุฅุฌูุงูู ุงููุจูุนุงุช</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="totalBranchesSales" title="ุฅุฌูุงูู ุงููุจูุนุงุช">--</div>
                            </div>
                            <div class="sap-tile-icon">๐ฐ</div>
                        </div>
                        <div class="sap-tile">
                            <div class="sap-tile-title">ุฃูุถู ูุฑุน</div>
                            <div class="sap-tile-content">
                                <div class="sap-tile-number" id="topBranchName" style="font-size: 1.5rem;">--</div>
                            </div>
                            <div class="sap-tile-icon">๐</div>
                        </div>
                    </div>

                    <div class="sap-card">
                        <div class="sap-card-header">
                            <h3 class="sap-card-title">ูุงุฆูุฉ ุงููุฑูุน</h3>
                            <input type="text" id="branchSearch" class="sap-input" placeholder="ุจุญุซ ูู ุงููุฑูุน..."
                                style="width: 250px;" oninput="filterBranches()">
                        </div>
                        <div class="sap-card-content" style="padding: 0;">
                            <div style="overflow-x: auto;">
                                <table class="sap-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>ุงุณู ุงููุฑุน</th>
                                            <th>ุนุฏุฏ ุงููุจูุนุงุช</th>
                                            <th>ุฅุฌูุงูู ุงููุจูุนุงุช</th>
                                            <th>ุงูุฃุฏุงุก</th>
                                            <th>ุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="branchesBody">
                                        <tr>
                                            <td colspan="7" style="text-align: center; padding: 2rem;">ุฌุงุฑู ุงูุชุญููู...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RECONCILIATION SECTION -->
                <div id="reconciliation-section" class="page-section" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0;">ุชุณููุฉ ุงูุตูุฏูู ุงูููููุฉ</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-sap btn-standard" onclick="openPOSManagement()">๐ช ุฅุฏุงุฑุฉ ููุงุท
                                ุงูุจูุน</button>
                            <button class="btn-sap btn-standard" onclick="openCashierManagement()">๐ค ุฅุฏุงุฑุฉ
                                ุงููุงุดูุฑ</button>
                            <button class="btn-sap btn-emphasized" onclick="showReconciliationForm()">โ ุชุณููุฉ
                                ุฌุฏูุฏุฉ</button>
                        </div>
                    </div>

                    <!-- POS Management (Hidden by default) -->
                    <div id="posManagementSection" style="display: none; margin-bottom: 1.5rem;">
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ุฅุฏุงุฑุฉ ููุงุท ุงูุจูุน</h3>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-sap btn-emphasized" onclick="openPOSModal()">โ ุฅุถุงูุฉ ููุทุฉ
                                        ุจูุน</button>
                                    <button class="btn-sap btn-transparent" onclick="hidePOSManagement()">โ</button>
                                </div>
                            </div>
                            <div class="sap-card-content">
                                <div style="overflow-x: auto;">
                                    <table class="sap-table">
                                        <thead>
                                            <tr>
                                                <th>ุงุณู ููุทุฉ ุงูุจูุน</th>
                                                <th>ุงููุงุดูุฑ ุงููุฑุชุจุท</th>
                                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                            </tr>
                                        </thead>
                                        <tbody id="posTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cashier Management (Hidden by default) -->
                    <div id="cashierManagementSection" style="display: none; margin-bottom: 1.5rem;">
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ุฅุฏุงุฑุฉ ุงููุงุดูุฑ</h3>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-sap btn-emphasized" onclick="openCashierModal()">โ ุฅุถุงูุฉ
                                        ูุงุดูุฑ</button>
                                    <button class="btn-sap btn-transparent" onclick="hideCashierManagement()">โ</button>
                                </div>
                            </div>
                            <div class="sap-card-content">
                                <div style="overflow-x: auto;">
                                    <table class="sap-table">
                                        <thead>
                                            <tr>
                                                <th>ุงุณู ุงููุงุดูุฑ</th>
                                                <th>ุฑูู ุงููุงุชู</th>
                                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cashierTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reconciliation Form (Hidden by default) -->
                    <div id="reconciliationFormSection" style="display: none; margin-bottom: 1.5rem;">
                        <div class="sap-card">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title" id="recFormTitle">ุชุณููุฉ ุฌุฏูุฏุฉ</h3>
                                <button class="btn-sap btn-transparent" onclick="hideReconciliationForm()">โ</button>
                            </div>
                            <div class="sap-card-content">
                                <form id="reconciliationForm" onsubmit="handleRecSubmit(event)">
                                    <input type="hidden" id="recId">
                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุงูุชุงุฑูุฎ</label>
                                            <input type="date" id="recDate" class="sap-input" required>
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ููุทุฉ ุงูุจูุน</label>
                                            <select id="recPos" class="sap-input" required>
                                                <option value="">ุงุฎุชุฑ ููุทุฉ ุงูุจูุน...</option>
                                            </select>
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุงููุงุดูุฑ</label>
                                            <select id="recCashier" class="sap-input" required>
                                                <option value="">ุงุฎุชุฑ ุงููุงุดูุฑ...</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุงููุจูุนุงุช (ุงููุธุงู)</label>
                                            <input type="number" id="recSales" class="sap-input" step="0.01" value="0"
                                                oninput="calculateRec()">
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ูุฑุชุฌุน ุงููุจูุนุงุช</label>
                                            <input type="number" id="recReturns" class="sap-input" step="0.01" value="0"
                                                oninput="calculateRec()">
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ูุจูุนุงุช ูุฏู</label>
                                            <input type="number" id="recMada" class="sap-input" step="0.01" value="0"
                                                oninput="calculateRec()">
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ูุจูุนุงุช ููุฒุง</label>
                                            <input type="number" id="recVisa" class="sap-input" step="0.01" value="0"
                                                oninput="calculateRec()">
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุงูููุฏูุฉ ุงููุณููุฉ</label>
                                            <input type="number" id="recCashHanded" class="sap-input" step="0.01"
                                                value="0" oninput="calculateRec()">
                                        </div>
                                    </div>

                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; background: var(--sap-bg-hover); padding: 1rem; border-radius: 4px;">
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุฅุฌูุงูู ุงููุจูุนุงุช</label>
                                            <div id="resTotalSales" style="font-weight: bold; font-size: 1.2rem;">0.00
                                            </div>
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุฅุฌูุงูู ุงูุดุจูุฉ (ูุฏู + ููุฒุง)</label>
                                            <div id="resTotalNetwork" style="font-weight: bold; font-size: 1.2rem;">0.00
                                            </div>
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุตุงูู ุงููุจูุนุงุช (ุงูููุฏูุฉ ุงููุชููุนุฉ)</label>
                                            <div id="resNetSales" style="font-weight: bold; font-size: 1.2rem;">0.00
                                            </div>
                                        </div>
                                        <div class="sap-input-group">
                                            <label class="sap-label">ุงููุฑู (ุฒูุงุฏุฉ / ุนุฌุฒ)</label>
                                            <div id="resDifference" style="font-weight: bold; font-size: 1.2rem;">0.00
                                            </div>
                                        </div>
                                    </div>

                                    <div class="sap-input-group">
                                        <label class="sap-label">ููุงุญุธุงุช</label>
                                        <textarea id="recNotes" class="sap-input" rows="2"></textarea>
                                    </div>

                                    <div
                                        style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
                                        <button type="button" class="btn-sap btn-standard"
                                            onclick="hideReconciliationForm()">ุฅูุบุงุก</button>
                                        <button type="submit" class="btn-sap btn-emphasized">ุญูุธ ุงูุชุณููุฉ</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Reconciliation History -->
                    <div class="sap-card">
                        <div class="sap-card-header">
                            <h3 class="sap-card-title">ุณุฌู ุงูุชุณููุงุช</h3>
                            <input type="text" id="searchRec" class="sap-input" placeholder="ุจุญุซ..."
                                style="width: 200px;">
                        </div>
                        <div class="sap-card-content" style="padding: 0;">
                            <div style="overflow-x: auto;">
                                <table class="sap-table" id="recTable">
                                    <thead>
                                        <tr>
                                            <th>ุงูุชุงุฑูุฎ</th>
                                            <th>ููุทุฉ ุงูุจูุน</th>
                                            <th>ุงููุงุดูุฑ</th>
                                            <th>ุตุงูู ุงููุจูุนุงุช</th>
                                            <th>ุงูููุฏูุฉ ุงููุณููุฉ</th>
                                            <th>ุงููุฑู</th>
                                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS SECTION -->
                <div id="analytics-section" class="page-section" style="display: none;">
                    <h2 style="margin-bottom: 1.5rem;">ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช</h2>

                    <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                        <!-- Sidebar Selection -->
                        <div class="sap-card" style="width: 250px; height: fit-content;">
                            <div class="sap-card-header">
                                <h3 class="sap-card-title">ููุน ุงูุชูุฑูุฑ</h3>
                            </div>
                            <div class="sap-card-content" style="padding: 0.5rem;">
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <button class="btn-sap btn-standard"
                                        style="justify-content: flex-start; width: 100%; border: none;"
                                        onclick="switchReport('daily')">๐ ุงูุชูุฑูุฑ ุงููููู</button>
                                    <button class="btn-sap btn-standard"
                                        style="justify-content: flex-start; width: 100%; border: none;"
                                        onclick="switchReport('monthly')">๐ ุงูุชูุฑูุฑ ุงูุดูุฑู</button>
                                    <button class="btn-sap btn-standard"
                                        style="justify-content: flex-start; width: 100%; border: none;"
                                        onclick="switchReport('custom')">๐ ุชูุฑูุฑ ูุฎุตุต</button>
                                    <button class="btn-sap btn-standard"
                                        style="justify-content: flex-start; width: 100%; border: none;"
                                        onclick="switchReport('branches')">๐ข ุฃุฏุงุก ุงููุฑูุน</button>
                                    <button class="btn-sap btn-standard"
                                        style="justify-content: flex-start; width: 100%; border: none;"
                                        onclick="switchReport('matrix')">๐ ูุตูููุฉ ุงููุจูุนุงุช</button>
                                    <button class="btn-sap btn-emphasized"
                                        style="justify-content: flex-start; width: 100%; margin-top: 0.5rem;"
                                        onclick="switchReport('ai')">๐ค ุชุญููู ุฐูู</button>
                                </div>
                            </div>
                        </div>

                        <!-- Main Display Area -->
                        <div class="sap-card" id="reportDisplayArea" style="flex: 1; min-height: 500px;">
                            <div
                                style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--sap-text-secondary); padding: 3rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">๐</div>
                                <h3>ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ ููุนุฑุถ</h3>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- POS Modal -->
    <div id="posModalOverlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div class="sap-card" style="width: 400px; max-width: 90%; margin: 0;">
            <div class="sap-card-header">
                <h3 class="sap-card-title" id="posModalTitle">ุฅุถุงูุฉ ููุทุฉ ุจูุน</h3>
                <button onclick="closePOSModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="sap-card-content">
                <form id="posForm" onsubmit="handlePOSSubmit(event)">
                    <input type="hidden" id="posId">
                    <div class="sap-input-group">
                        <label class="sap-label">ุงุณู ููุทุฉ ุงูุจูุน *</label>
                        <input type="text" id="posName" class="sap-input" required placeholder="ูุซุงู: ูุงุดูุฑ 1">
                    </div>
                    <div class="sap-input-group">
                        <label class="sap-label">ุงุณู ุงููุงุดูุฑ ุงููุฑุชุจุท</label>
                        <input type="text" id="posCashier" class="sap-input" placeholder="ุงุณู ุงูููุธู">
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-sap btn-standard" onclick="closePOSModal()">ุฅูุบุงุก</button>
                        <button type="submit" class="btn-sap btn-emphasized">ุญูุธ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cashier Modal -->
    <div id="cashierModalOverlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div class="sap-card" style="width: 400px; max-width: 90%; margin: 0;">
            <div class="sap-card-header">
                <h3 class="sap-card-title" id="cashierModalTitle">ุฅุถุงูุฉ ูุงุดูุฑ</h3>
                <button onclick="closeCashierModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="sap-card-content">
                <form id="cashierForm" onsubmit="handleCashierSubmit(event)">
                    <input type="hidden" id="cashierId">
                    <div class="sap-input-group">
                        <label class="sap-label">ุงุณู ุงููุงุดูุฑ *</label>
                        <input type="text" id="cashierName" class="sap-input" required placeholder="ุงุณู ุงูููุธู">
                    </div>
                    <div class="sap-input-group">
                        <label class="sap-label">ุฑูู ุงููุงุชู</label>
                        <input type="text" id="cashierPhone" class="sap-input" placeholder="05xxxxxxxx">
                    </div>
                    <div class="sap-input-group">
                        <label class="sap-label">ููุงุญุธุงุช</label>
                        <textarea id="cashierNotes" class="sap-input" rows="2"></textarea>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-sap btn-standard" onclick="closeCashierModal()">ุฅูุบุงุก</button>
                        <button type="submit" class="btn-sap btn-emphasized">ุญูุธ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Branch Modal -->
    <div id="branchModalOverlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div class="sap-card" style="width: 400px; max-width: 90%; margin: 0;">
            <div class="sap-card-header">
                <h3 class="sap-card-title" id="branchModalTitle">ุฅุถุงูุฉ ูุฑุน ุฌุฏูุฏ</h3>
                <button onclick="closeBranchModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="sap-card-content">
                <form id="branchForm" onsubmit="handleBranchSubmit(event)">
                    <input type="hidden" id="branchId">
                    <div class="sap-input-group">
                        <label class="sap-label">ุงุณู ุงููุฑุน *</label>
                        <input type="text" id="branchName" class="sap-input" required placeholder="ูุซุงู: ูุฑุน ุงูุฑูุงุถ">
                    </div>
                    <div class="sap-input-group">
                        <label class="sap-label">ุงููุตู</label>
                        <textarea id="branchDescription" class="sap-input" rows="3"></textarea>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn-sap btn-standard" onclick="closeBranchModal()">ุฅูุบุงุก</button>
                        <button type="submit" class="btn-sap btn-emphasized">ุญูุธ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Print Frame -->
    <iframe id="printFrame" style="display:none"></iframe>

    <!-- SheetJS -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- Core Scripts -->
    <script src="js/core/data.js"></script>
    <script src="js/core/utils.js"></script>
    <script src="js/core/excel-handler.js"></script>
    <script src="js/pages/home.js"></script>
    <script src="js/pages/clean-sales.js"></script>
    <script src="js/pages/branches.js"></script>
    <script src="js/pages/analytics.js"></script>
    <script src="js/pages/ai-analytics.js"></script>
    <script src="js/pages/pos-reconciliation.js"></script>
    <script src="js/pages/print-reports.js"></script>
    <script src="js/pages/settings.js"></script>

    <script>
        // Router Logic
        function navigateTo(pageId) {
            // Hide all sections
            document.querySelectorAll('.page-section').forEach(section => {
                section.style.display = 'none';
            });

            // Show target section
            const targetSection = document.getElementById(`${pageId}-section`);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Update Sidebar Active State
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${pageId}'`)) {
                    item.classList.add('active');
                }
            });

            // Page specific init
            if (pageId === 'home') {
                if (typeof updateDashboard === 'function') updateDashboard();
            } else if (pageId === 'sales') {
                if (typeof loadBranches === 'function') loadBranches();
                const dateInput = document.getElementById('saleDate');
                if (dateInput && !dateInput.value) dateInput.valueAsDate = new Date();
            } else if (pageId === 'branches') {
                if (typeof renderBranchesTable === 'function') renderBranchesTable();
            } else if (pageId === 'reconciliation') {
                if (typeof initRecPage === 'function') initRecPage();
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');

            if (sidebar.style.transform === 'translateX(100%)' || getComputedStyle(sidebar).transform === 'matrix(1, 0, 0, 1, 240, 0)') {
                // It's hidden (RTL positive translate), show it
                sidebar.style.transform = 'translateX(0)';
                if (window.innerWidth > 992) mainContent.style.marginRight = '240px';
            } else {
                // It's shown, hide it
                sidebar.style.transform = 'translateX(100%)'; // Move right to hide in RTL
                mainContent.style.marginRight = '0';
            }
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                navigateTo('home');
            }, 500);

            // Register Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./sw.js')
                        .then(reg => console.log('Service Worker registered', reg))
                        .catch(err => console.error('Service Worker registration failed', err));
                });
            }
        });
    </script>

    <!-- Footer -->
    <div class="sap-footer">
        <div class="sap-footer-left">
            <span id="footerDate"></span>
            <span style="margin: 0 5px;">|</span>
            <span id="footerTime"></span>
        </div>
        <div class="sap-footer-right">
            Designed by Khaled Rizk 0538611816
        </div>
    </div>

</body>

</html>